(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{196:function(e){e.exports=JSON.parse("{}")},197:function(e){e.exports=JSON.parse("{}")},198:function(e){e.exports=JSON.parse("{}")},199:function(e){e.exports=JSON.parse("{}")},200:function(e){e.exports=JSON.parse("{}")},201:function(e){e.exports=JSON.parse("{}")},202:function(e){e.exports=JSON.parse("{}")},203:function(e){e.exports=JSON.parse("{}")},204:function(e){e.exports=JSON.parse("{}")},205:function(e){e.exports=JSON.parse("{}")},206:function(e){e.exports=JSON.parse("{}")},207:function(e){e.exports=JSON.parse("{}")},208:function(e){e.exports=JSON.parse("{}")},219:function(e,t){},466:function(e,t,a){},474:function(e,t){},480:function(e,t){},501:function(e,t,a){"use strict";a.r(t);a(253);var r=a(17),n=a(22),o=a(237),c=a(515),s=a(235),i=a(0),l=a.n(i),u=a(31),m=a.n(u),d=a(196),f=a(197),p={ar:d,"es-419":a(198),fr:a(199),"zh-cn":a(200),ca:f,he:a(201),id:a(202),"ko-kr":a(203),pl:a(204),"pt-br":a(205),ru:a(206),th:a(207),uk:a(208)},v=a(66),g=a(52),b=a(1),E=a.n(b),h=a(108),y=a(512),w=a(42),x=a(102),N=a(209),j=a(210);function O(e,t,a,r,n,o,c){try{var s=e[o](c),i=s.value}catch(e){return void a(e)}s.done?t(i):Promise.resolve(i).then(r,n)}var I=function(){var e,t=(e=regeneratorRuntime.mark((function e(t){var a,r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getUserEmail loaded"),a="/courses/".concat(t,"/course_emails/user_email"),e.next=4,fetch(a,{credentials:"same-origin"});case 4:if(200!=(r=e.sent).status){e.next=12;break}return e.next=8,r.json();case 8:return n=e.sent,e.abrupt("return",n);case 12:return e.abrupt("return",[]);case 13:case"end":return e.stop()}}),e)})),function(){var t=this,a=arguments;return new Promise((function(r,n){var o=e.apply(t,a);function c(e){O(o,r,n,c,s,"next",e)}function s(e){O(o,r,n,c,s,"throw",e)}c(void 0)}))});return function(e){return t.apply(this,arguments)}}();function S(e,t,a,r,n,o,c){try{var s=e[o](c),i=s.value}catch(e){return void a(e)}s.done?t(i):Promise.resolve(i).then(r,n)}var _=function(){var e,t=(e=regeneratorRuntime.mark((function e(t){var a,r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getUsers loaded"),a="/courses/".concat(t,"/course_emails/users"),e.next=4,fetch(a,{credentials:"same-origin"});case 4:if(200!=(r=e.sent).status){e.next=13;break}return e.next=8,r.json();case 8:return n=e.sent,o=n.map((function(e){return{username:e.username,name:e.profile__name,has_role:e.has_role}})),e.abrupt("return",o);case 13:return e.abrupt("return",[]);case 14:case"end":return e.stop()}}),e)})),function(){var t=this,a=arguments;return new Promise((function(r,n){var o=e.apply(t,a);function c(e){S(o,r,n,c,s,"next",e)}function s(e){S(o,r,n,c,s,"throw",e)}c(void 0)}))});return function(e){return t.apply(this,arguments)}}();function k(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e))&&"[object Arguments]"!==Object.prototype.toString.call(e))return;var a=[],r=!0,n=!1,o=void 0;try{for(var c,s=e[Symbol.iterator]();!(r=(c=s.next()).done)&&(a.push(c.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var R=[];function C(e){var t=function(e){var t=k(Object(i.useState)({email:"",loading:!0}),2),a=t[0],r=t[1];return Object(i.useEffect)((function(){I(e).then((function(e){console.log("useFetchUserEmail loaded"),r({email:e,loading:!1})}))}),[]),a}(e.courseId),a=t.email,r=t.loading;return console.log("Menu loaded"),l.a.createElement("div",{className:"my-2"},l.a.createElement("div",{className:"d-flex justify-content-center text-muted small"},r&&l.a.createElement(y.a,{animation:"border",variant:"primary",className:"mx-auto mt-2 "}),!r&&l.a.createElement("p",null,"El correo electrónico que tienes registrado en la plataforma es ",l.a.createElement("strong",{className:"text-uppercase"},a)," ",l.a.createElement("i",null,"(",l.a.createElement("a",{href:"/account/settings",target:"_parent"},"Actualizar correo"),")"))),l.a.createElement("div",{className:"d-flex"},l.a.createElement(v.b,{to:"/eol/eol_course_email/static/received/"},l.a.createElement(h.a,{variant:"outline-primary shadow-sm",size:"sm"},l.a.createElement(w.a,{icon:N.faArrowDown,className:"mr-2"}),"Recibidos")),l.a.createElement(v.b,{to:"/eol/eol_course_email/static/sended/",className:"mr-auto"},l.a.createElement(h.a,{variant:"outline-primary shadow-sm",size:"sm",className:"mx-3"},l.a.createElement(w.a,{icon:j.faArrowUp,className:"mr-2"}),"Enviados")),l.a.createElement(v.b,{to:"/eol/eol_course_email/static/new/"},l.a.createElement(h.a,{variant:"primary shadow-sm",size:"sm"},l.a.createElement(w.a,{icon:x.faPaperPlane,className:"mr-2"}),"Nuevo Correo"))))}C.propTypes={courseId:E.a.string.isRequired};var A=a(68);function P(e,t,a,r,n,o,c){try{var s=e[o](c),i=s.value}catch(e){return void a(e)}s.done?t(i):Promise.resolve(i).then(r,n)}var L=function(){var e,t=(e=regeneratorRuntime.mark((function e(t){var a,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("postSendEmail loaded"),a="/courses/".concat(t.courseId,"/course_emails/send"),e.next=4,Object(A.e)().post(a,t,"json").then((function(e){var t=e.status;return console.log(t),201==t})).catch((function(e){return console.log(e),!1}));case 4:return r=e.sent,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})),function(){var t=this,a=arguments;return new Promise((function(r,n){var o=e.apply(t,a);function c(e){P(o,r,n,c,s,"next",e)}function s(e){P(o,r,n,c,s,"throw",e)}c(void 0)}))});return function(e){return t.apply(this,arguments)}}();function T(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function D(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function J(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?D(Object(a),!0).forEach((function(t){q(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):D(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function q(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function z(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e))&&"[object Arguments]"!==Object.prototype.toString.call(e))return;var a=[],r=!0,n=!1,o=void 0;try{for(var c,s=e[Symbol.iterator]();!(r=(c=s.next()).done)&&(a.push(c.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var M=a(517),G=a(213),F=a(516),B=function(e){switch(e.status){case"pending":return l.a.createElement(y.a,{animation:"border",variant:"primary",className:"d-flex mx-auto mt-2 "});case"fail":return l.a.createElement(F.a,{variant:"danger",className:"mx-4 mt-3 text-center w-100 shadow"},"Error al enviar correo. Intentar nuevamente.");case"success":return l.a.createElement(F.a,{variant:"success",className:"mx-4 mt-3 text-center w-100 shadow"},l.a.createElement("strong",null,"Tu mensaje fue procesado con éxito para ser enviado"),".",l.a.createElement("br",null),"Los destinatarios comenzarán a recibir el correo en los próximos minutos.");case"empty-list":return l.a.createElement(F.a,{variant:"warning",className:"mx-4 mt-3 text-center w-100 shadow"},l.a.createElement("strong",null,"Debes seleccionar al menos un destinatario."));default:return l.a.createElement(l.a.Fragment,null)}};function U(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e))&&"[object Arguments]"!==Object.prototype.toString.call(e))return;var a=[],r=!0,n=!1,o=void 0;try{for(var c,s=e[Symbol.iterator]();!(r=(c=s.next()).done)&&(a.push(c.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}B.propTypes={status:E.a.string.isRequired};var H=function(e){var t=e.courseId;console.log("NewEmailForm loaded");var a=function(e){var t=k(Object(i.useState)({users:[],loading:!0}),2),a=t[0],r=t[1];return Object(i.useEffect)((function(){0!=R.length?(console.log("users cache loaded"),r({users:R,loading:!1})):_(e).then((function(e){console.log("useFetchUsers loaded"),R=e,r({users:e,loading:!1})}))}),[]),a}(t),r=a.users,n=a.loading,o=U(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object(i.useState)(e),a=z(t,2),r=a[0],n=a[1],o=function(e){var t=e.target;console.log("handleInputChange"),"studentsInput"===t.name||"staffInput"===t.name?c(t):n(J(J({},r),{},q({},t.name,t.value)))},c=function(e){var t=T(r[e.name]);e.checked?n(J(J({},r),{},q({},e.name,[].concat(T(t),[e.id])))):(t.splice(t.indexOf(e.id),1),n(J(J({},r),{},q({},e.name,t))))},s=function(e){e.preventDefault(),l()&&(n(J(J({},r),{},{status:"pending"})),L(r).then((function(e){e?u("success"):n(J(J({},r),{},{status:"fail"}))})))},l=function(){var e=r.studentsInput,t=r.staffInput;return e.length+t.length!=0||(n(J(J({},r),{},{status:"empty-list"})),!1)},u=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"initialized";n(J(J({},e),{},{status:t}))};return[r,o,s]}({status:"initialized",subjectInput:"",messageInput:"",studentsInput:[],staffInput:[],courseId:t}),3),c=o[0],s=o[1],u=o[2],m=c.status,d=c.subjectInput,f=c.messageInput,p=c.studentsInput,v=c.staffInput;return l.a.createElement("div",{className:"rounded-lg shadow-lg py-4 px-5 my-2"},l.a.createElement("h3",null,"Formulario Nuevo Correo "),l.a.createElement(M.a,{onSubmit:u},l.a.createElement(M.a.Group,{controlId:"formGridSubject"},l.a.createElement(M.a.Label,{className:"lead"},"Asunto"),l.a.createElement(M.a.Control,{required:!0,placeholder:"Asunto del correo","aria-describedby":"subjectInput",name:"subjectInput",onChange:s,value:d})),l.a.createElement(M.a.Group,{controlId:"formGridMessage"},l.a.createElement(M.a.Label,{className:"lead"},"Mensaje"),l.a.createElement(M.a.Control,{required:!0,as:"textarea",placeholder:"Mensaje del correo","aria-describedby":"messageInput",name:"messageInput",onChange:s,value:f})),l.a.createElement("hr",null),l.a.createElement(M.a.Group,{id:"formGridCheckbox"}),l.a.createElement(M.a.Row,null,n&&l.a.createElement(y.a,{animation:"border",variant:"primary",className:"d-flex mx-auto mt-2 "}),l.a.createElement(M.a.Group,{as:G.a,controlId:"formGridReceiverStudent",className:"checkbox-group"},l.a.createElement(M.a.Label,{className:"lead"},"Destinatarios Estudiantes"),l.a.createElement("div",{className:"checkbox-input"},r.filter((function(e){return!e.has_role})).map((function(e){return l.a.createElement(M.a.Check,{type:"checkbox",className:"pl-0",name:"studentsInput",id:e.username,key:e.username,label:e.name,onChange:s,checked:p.includes(e.username)})})))),l.a.createElement(M.a.Group,{as:G.a,controlId:"formGridReceiverStaff",className:"checkbox-group"},l.a.createElement(M.a.Label,{className:"lead"},"Destinatarios Staff"),l.a.createElement("div",{className:"checkbox-input"},r.filter((function(e){return e.has_role})).map((function(e){return l.a.createElement(M.a.Check,{type:"checkbox",className:"pl-0",name:"staffInput",id:e.username,key:e.username,label:e.name,onChange:s,checked:v.includes(e.username)})}))))),l.a.createElement(M.a.Row,null,l.a.createElement(h.a,{variant:"outline-primary shadow-lg",size:"lg",type:"submit",className:"mx-auto",disabled:"pending"==m},l.a.createElement(w.a,{icon:x.faPaperPlane,className:"mr-2"})," Enviar Correo")),l.a.createElement(M.a.Row,{className:"form-status"},l.a.createElement(B,{status:m}))))};H.propTypes={courseId:E.a.string.isRequired};var W=a(514),$=a(214),V=a(513),K=function(e){var t=e.email,a=e.modalState,r=e.setModalState;console.log("EmailModal loaded");var n=function(){return r(!1)},o=Object(i.useRef)(null);Object(i.useLayoutEffect)((function(){return window.parent.parent.scrollTo(0,o.current.modalBodyRef.current.offsetTop)}),[]);return l.a.createElement(V.a,{ref:o,open:a,title:"Detalle del correo",body:l.a.createElement("div",{className:"row px-2"},l.a.createElement("div",{className:"font-weight-bold col col-3 py-2"},"Fecha"),l.a.createElement("div",{className:"col col-9 py-2"},t.date),l.a.createElement("div",{className:"font-weight-bold col col-3 py-2"},"Enviado por"),l.a.createElement("div",{className:"col col-9 py-2"},t.sender),l.a.createElement("div",{className:"font-weight-bold col col-3 py-2"},"Asunto"),l.a.createElement("div",{className:"col col-9 py-2"},t.subject),l.a.createElement("div",{className:"font-weight-bold col col-3 py-2"},"Contenido"),l.a.createElement("div",{className:"text-justify col col-9 py-2"},t.message),t.receiver_users&&l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"font-weight-bold col col-3 py-2"},"Destinatarios (",t.receiver_users.length,")"),l.a.createElement("div",{className:"text-justify col col-9 py-2"},l.a.createElement("ol",null,t.receiver_users.map((function(e){return l.a.createElement("li",{key:e},e)})))))),onClose:n,buttons:[l.a.createElement(h.a,{variant:"primary",onClick:n,"data-autofocus":!0},"Cerrar")],renderDefaultCloseButton:!1,dialogClassName:"modal-lg"})};function Q(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e))&&"[object Arguments]"!==Object.prototype.toString.call(e))return;var a=[],r=!0,n=!1,o=void 0;try{for(var c,s=e[Symbol.iterator]();!(r=(c=s.next()).done)&&(a.push(c.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}K.propTypes={email:E.a.object.isRequired,modalState:E.a.bool.isRequired,setModalState:E.a.func.isRequired};var X=function(e){var t=e.email;console.log("EmailItem loaded");var a=Q(Object(i.useState)(!1),2),r=a[0],n=a[1];return l.a.createElement("div",{className:"row border-bottom"},l.a.createElement("div",{className:"col col-3 pt-2"},t.date),l.a.createElement("div",{className:"col col-3 pt-2"},t.sender),l.a.createElement("div",{className:"col col-5 pt-2"},t.subject),l.a.createElement("div",{className:"col col-1"},l.a.createElement(W.a,{icon:$.faInfo,alt:"Ver mayor información del correo",onClick:function(){return n(!0)},variant:"primary"})),r&&l.a.createElement(K,{email:t,modalState:r,setModalState:n}))};X.propTypes={email:E.a.object.isRequired};var Y=a(216),Z=function(e){var t=e.title;return l.a.createElement("div",{className:"text-center"},l.a.createElement(w.a,{icon:Y.faFrown,className:"h1"}),l.a.createElement("p",null,"Al parecer no tienes ",t.toLowerCase(),"."))};Z.propTypes={title:E.a.string.isRequired};var ee,te,ae=function(e){var t=e.getEmails,a=e.title,r=e.courseId;console.log("".concat(a," loaded"));var n=function(e,t){var a=k(Object(i.useState)({data:[],loading:!0}),2),r=a[0],n=a[1];return Object(i.useEffect)((function(){n({data:[],loading:!0}),t(e).then((function(e){console.log("emails loaded"),n({data:e,loading:!1})}))}),[t]),r}(r,t),o=n.data,c=n.loading;return l.a.createElement("div",{className:"rounded-lg shadow-lg py-4 px-5 my-2"},l.a.createElement("h3",null,a),c&&l.a.createElement(y.a,{animation:"border",variant:"primary",className:"d-flex mx-auto mt-2 "}),!c&&(0==o.length?l.a.createElement(Z,{title:a}):l.a.createElement("div",{className:"email-grid"},l.a.createElement("div",{className:"row font-weight-bold border-bottom py-2"},l.a.createElement("div",{className:"col col-3"},"Fecha"),l.a.createElement("div",{className:"col col-3"},"Enviado por"),l.a.createElement("div",{className:"col col-5"},"Asunto"),l.a.createElement("div",{className:"col col-1 text-center"},"Detalle")),o.map((function(e,t){return l.a.createElement(X,{key:t,email:e})})))))};ae.propTypes={getEmails:E.a.func.isRequired,title:E.a.string.isRequired,courseId:E.a.string.isRequired};var re=function(e){console.log("dispatchResizeMessage");var t=e.type||"mutate",a=document.getElementById("content").offsetHeight,r=document.getElementById("content").offsetWidth;"load"!==t&&r===te&&a===ee||(window.parent.postMessage({type:"plugin.resize",payload:{width:r,height:a}},document.referrer),ee=a,te=r,window.scrollTo(0,0))};function ne(e,t,a,r,n,o,c){try{var s=e[o](c),i=s.value}catch(e){return void a(e)}s.done?t(i):Promise.resolve(i).then(r,n)}var oe=function(){var e,t=(e=regeneratorRuntime.mark((function e(t){var a,r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getReceivedEmails loaded"),a="/courses/".concat(t,"/course_emails/received"),e.next=4,fetch(a,{credentials:"same-origin"});case 4:if(200!=(r=e.sent).status){e.next=13;break}return e.next=8,r.json();case 8:return n=e.sent,o=n.map((function(e){return{subject:e.subject,message:e.message,sender:e.sender_user__profile__name,date:new Date(e.created_at.$date).toLocaleString("es-CL")}})),e.abrupt("return",o);case 13:return e.abrupt("return",[]);case 14:case"end":return e.stop()}}),e)})),function(){var t=this,a=arguments;return new Promise((function(r,n){var o=e.apply(t,a);function c(e){ne(o,r,n,c,s,"next",e)}function s(e){ne(o,r,n,c,s,"throw",e)}c(void 0)}))});return function(e){return t.apply(this,arguments)}}();function ce(e,t,a,r,n,o,c){try{var s=e[o](c),i=s.value}catch(e){return void a(e)}s.done?t(i):Promise.resolve(i).then(r,n)}var se=function(){var e,t=(e=regeneratorRuntime.mark((function e(t){var a,r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getSendedEmails loaded"),a="/courses/".concat(t,"/course_emails/sended"),e.next=4,fetch(a,{credentials:"same-origin"});case 4:if(200!=(r=e.sent).status){e.next=13;break}return e.next=8,r.json();case 8:return n=e.sent,o=n.map((function(e){return{subject:e.subject,message:e.message,sender:e.sender_user,receiver_users:e.receiver_users_list,date:new Date(e.created_at.$date).toLocaleString("es-CL")}})),e.abrupt("return",o);case 13:return e.abrupt("return",[]);case 14:case"end":return e.stop()}}),e)})),function(){var t=this,a=arguments;return new Promise((function(r,n){var o=e.apply(t,a);function c(e){ce(o,r,n,c,s,"next",e)}function s(e){ce(o,r,n,c,s,"throw",e)}c(void 0)}))});return function(e){return t.apply(this,arguments)}}();function ie(){Object(i.useEffect)((function(){return window!==window.parent&&(document.body.className+=" view-in-mfe",ee=window.offsetHeight,te=window.offsetWidth,new MutationObserver(re).observe(document.body,{attributes:!0,childList:!0,subtree:!0}),window.addEventListener("load",re),window.addEventListener("resize",re)),function(){window.removeEventListener("load",re),window.removeEventListener("resize",re)}}),[]);var e=window.location.hash.substring(1).split(/[\/]+/).pop();return l.a.createElement("div",{id:"content",className:"container"},l.a.createElement(v.a,null,l.a.createElement("div",null,l.a.createElement(C,{courseId:e}),l.a.createElement(g.c,null,l.a.createElement(g.a,{exact:!0,path:"/eol/eol_course_email/static/sended/"},l.a.createElement(ae,{getEmails:se,title:"Correos Enviados",courseId:e})),l.a.createElement(g.a,{exact:!0,path:"/eol/eol_course_email/static/received/"},l.a.createElement(ae,{getEmails:oe,title:"Correos Recibidos",courseId:e})),l.a.createElement(g.a,{exact:!0,path:"/eol/eol_course_email/static/new/"},l.a.createElement(H,{courseId:e})),l.a.createElement(g.a,{exact:!0,path:"/eol/eol_course_email/static/:courseId/"},l.a.createElement(ae,{getEmails:oe,title:"Correos Recibidos",courseId:e}))))))}a(466),a.p;Object(r.b)(n.h,(function(){m.a.render(l.a.createElement(c.a,null,l.a.createElement(ie,null)),document.getElementById("root"))})),Object(r.b)(n.e,(function(e){m.a.render(l.a.createElement(s.a,{message:e.message}),document.getElementById("root"))})),Object(o.b)({messages:[p]})}},[[501,1,2]]]);
//# sourceMappingURL=app.1786cd62a2c876fd4be8.js.map