(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{196:function(e){e.exports=JSON.parse("{}")},197:function(e){e.exports=JSON.parse("{}")},198:function(e){e.exports=JSON.parse("{}")},199:function(e){e.exports=JSON.parse("{}")},200:function(e){e.exports=JSON.parse("{}")},201:function(e){e.exports=JSON.parse("{}")},202:function(e){e.exports=JSON.parse("{}")},203:function(e){e.exports=JSON.parse("{}")},204:function(e){e.exports=JSON.parse("{}")},205:function(e){e.exports=JSON.parse("{}")},206:function(e){e.exports=JSON.parse("{}")},207:function(e){e.exports=JSON.parse("{}")},208:function(e){e.exports=JSON.parse("{}")},219:function(e,t){},466:function(e,t,a){},474:function(e,t){},480:function(e,t){},501:function(e,t,a){"use strict";a.r(t);a(253);var r=a(17),n=a(22),o=a(237),c=a(515),s=a(235),l=a(0),i=a.n(l),u=a(31),m=a.n(u),d=a(196),f=a(197),p={ar:d,"es-419":a(198),fr:a(199),"zh-cn":a(200),ca:f,he:a(201),id:a(202),"ko-kr":a(203),pl:a(204),"pt-br":a(205),ru:a(206),th:a(207),uk:a(208)},v=a(66),b=a(51),g=a(108),E=a(42),h=a(102),y=a(209),w=a(210);function x(){return console.log("Menu loaded"),i.a.createElement("div",null,i.a.createElement("div",{className:"d-flex my-2"},i.a.createElement(v.b,{to:"/eol/eol_course_email/static/received/"},i.a.createElement(g.a,{variant:"outline-primary shadow-lg",size:"sm"},i.a.createElement(E.a,{icon:y.faArrowDown,className:"mr-2"}),"Recibidos")),i.a.createElement(v.b,{to:"/eol/eol_course_email/static/sended/",className:"mr-auto"},i.a.createElement(g.a,{variant:"outline-primary shadow-lg",size:"sm",className:"mx-3"},i.a.createElement(E.a,{icon:w.faArrowUp,className:"mr-2"}),"Enviados")),i.a.createElement(v.b,{to:"/eol/eol_course_email/static/new/"},i.a.createElement(g.a,{variant:"primary shadow-lg",size:"sm"},i.a.createElement(E.a,{icon:h.faPaperPlane,className:"mr-2"}),"Nuevo Correo"))))}var N=a(1),j=a.n(N);function O(e,t,a,r,n,o,c){try{var s=e[o](c),l=s.value}catch(e){return void a(e)}s.done?t(l):Promise.resolve(l).then(r,n)}var S=function(){var e,t=(e=regeneratorRuntime.mark((function e(t){var a,r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getUsers loaded"),a="/courses/".concat(t,"/course_emails/users"),e.next=4,fetch(a,{credentials:"same-origin"});case 4:if(200!=(r=e.sent).status){e.next=13;break}return e.next=8,r.json();case 8:return n=e.sent,o=n.map((function(e){return{username:e.username,name:e.profile__name,has_role:e.has_role,email:e.email}})),e.abrupt("return",o);case 13:return e.abrupt("return",[]);case 14:case"end":return e.stop()}}),e)})),function(){var t=this,a=arguments;return new Promise((function(r,n){var o=e.apply(t,a);function c(e){O(o,r,n,c,s,"next",e)}function s(e){O(o,r,n,c,s,"throw",e)}c(void 0)}))});return function(e){return t.apply(this,arguments)}}();function I(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e))&&"[object Arguments]"!==Object.prototype.toString.call(e))return;var a=[],r=!0,n=!1,o=void 0;try{for(var c,s=e[Symbol.iterator]();!(r=(c=s.next()).done)&&(a.push(c.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var _=[],k=a(68);function R(e,t,a,r,n,o,c){try{var s=e[o](c),l=s.value}catch(e){return void a(e)}s.done?t(l):Promise.resolve(l).then(r,n)}var C=function(){var e,t=(e=regeneratorRuntime.mark((function e(t){var a,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("postSendEmail loaded"),a="/courses/".concat(t.courseId,"/course_emails/send"),e.next=4,Object(k.e)().post(a,t,"json").then((function(e){var t=e.status;return console.log(t),201==t})).catch((function(e){return console.log(e),!1}));case 4:return r=e.sent,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})),function(){var t=this,a=arguments;return new Promise((function(r,n){var o=e.apply(t,a);function c(e){R(o,r,n,c,s,"next",e)}function s(e){R(o,r,n,c,s,"throw",e)}c(void 0)}))});return function(e){return t.apply(this,arguments)}}();function A(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function P(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function L(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?P(Object(a),!0).forEach((function(t){D(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):P(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function D(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function J(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e))&&"[object Arguments]"!==Object.prototype.toString.call(e))return;var a=[],r=!0,n=!1,o=void 0;try{for(var c,s=e[Symbol.iterator]();!(r=(c=s.next()).done)&&(a.push(c.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var T=a(517),q=a(512),z=a(213),M=a(516),G=function(e){switch(e.status){case"pending":return i.a.createElement(q.a,{animation:"border",variant:"primary",className:"d-flex mx-auto mt-2 "});case"fail":return i.a.createElement(M.a,{variant:"danger",className:"mx-4 mt-3 text-center w-100 shadow"},"Error al enviar correo. Intentar nuevamente.");case"success":return i.a.createElement(M.a,{variant:"success",className:"mx-4 mt-3 text-center w-100 shadow"},i.a.createElement("strong",null,"Tu mensaje fue procesado con éxito para ser enviado"),".",i.a.createElement("br",null),"Los destinatarios comenzarán a recibir el correo en los próximos minutos.");case"empty-list":return i.a.createElement(M.a,{variant:"warning",className:"mx-4 mt-3 text-center w-100 shadow"},i.a.createElement("strong",null,"Debes seleccionar al menos un destinatario."));default:return i.a.createElement(i.a.Fragment,null)}};function F(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e))&&"[object Arguments]"!==Object.prototype.toString.call(e))return;var a=[],r=!0,n=!1,o=void 0;try{for(var c,s=e[Symbol.iterator]();!(r=(c=s.next()).done)&&(a.push(c.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}G.propTypes={status:j.a.string.isRequired};var B=function(e){var t=e.courseId;console.log("NewEmailForm loaded");var a=function(e){var t=I(Object(l.useState)({users:[],loading:!0}),2),a=t[0],r=t[1];return Object(l.useEffect)((function(){0!=_.length?(console.log("users cache loaded"),r({users:_,loading:!1})):S(e).then((function(e){console.log("useFetchUsers loaded"),_=e,r({users:e,loading:!1})}))}),[]),a}(t),r=a.users,n=a.loading,o=F(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object(l.useState)(e),a=J(t,2),r=a[0],n=a[1],o=function(e){var t=e.target;console.log("handleInputChange"),"studentsInput"===t.name||"staffInput"===t.name?c(t):n(L(L({},r),{},D({},t.name,t.value)))},c=function(e){var t=A(r[e.name]);e.checked?n(L(L({},r),{},D({},e.name,[].concat(A(t),[e.id])))):(t.splice(t.indexOf(e.id),1),n(L(L({},r),{},D({},e.name,t))))},s=function(e){e.preventDefault(),i()&&(n(L(L({},r),{},{status:"pending"})),C(r).then((function(e){e?u("success"):n(L(L({},r),{},{status:"fail"}))})))},i=function(){var e=r.studentsInput,t=r.staffInput;return e.length+t.length!=0||(n(L(L({},r),{},{status:"empty-list"})),!1)},u=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"initialized";n(L(L({},e),{},{status:t}))};return[r,o,s]}({status:"initialized",subjectInput:"",messageInput:"",studentsInput:[],staffInput:[],courseId:t}),3),c=o[0],s=o[1],u=o[2],m=c.status,d=c.subjectInput,f=c.messageInput,p=c.studentsInput,v=c.staffInput;return i.a.createElement("div",{className:"rounded-lg shadow-lg py-4 px-5 my-2"},i.a.createElement("h3",null,"Formulario Nuevo Correo "),i.a.createElement(T.a,{onSubmit:u},i.a.createElement(T.a.Group,{controlId:"formGridSubject"},i.a.createElement(T.a.Label,{className:"lead"},"Asunto"),i.a.createElement(T.a.Control,{required:!0,placeholder:"Asunto del correo","aria-describedby":"subjectInput",name:"subjectInput",onChange:s,value:d})),i.a.createElement(T.a.Group,{controlId:"formGridMessage"},i.a.createElement(T.a.Label,{className:"lead"},"Mensaje"),i.a.createElement(T.a.Control,{required:!0,as:"textarea",placeholder:"Mensaje del correo","aria-describedby":"messageInput",name:"messageInput",onChange:s,value:f})),i.a.createElement("hr",null),i.a.createElement(T.a.Group,{id:"formGridCheckbox"}),i.a.createElement(T.a.Row,null,n&&i.a.createElement(q.a,{animation:"border",variant:"primary",className:"d-flex mx-auto mt-2 "}),i.a.createElement(T.a.Group,{as:z.a,controlId:"formGridReceiverStudent",className:"checkbox-group"},i.a.createElement(T.a.Label,{className:"lead"},"Destinatarios Estudiantes"),i.a.createElement("div",{className:"checkbox-input"},r.filter((function(e){return!e.has_role})).map((function(e){return i.a.createElement(T.a.Check,{type:"checkbox",className:"pl-0",name:"studentsInput",id:e.username,key:e.username,label:e.name,onChange:s,checked:p.includes(e.username)})})))),i.a.createElement(T.a.Group,{as:z.a,controlId:"formGridReceiverStaff",className:"checkbox-group"},i.a.createElement(T.a.Label,{className:"lead"},"Destinatarios Staff"),i.a.createElement("div",{className:"checkbox-input"},r.filter((function(e){return e.has_role})).map((function(e){return i.a.createElement(T.a.Check,{type:"checkbox",className:"pl-0",name:"staffInput",id:e.username,key:e.username,label:e.name,onChange:s,checked:v.includes(e.username)})}))))),i.a.createElement(T.a.Row,null,i.a.createElement(g.a,{variant:"outline-primary shadow-lg",size:"lg",type:"submit",className:"mx-auto",disabled:"pending"==m},i.a.createElement(E.a,{icon:h.faPaperPlane,className:"mr-2"})," Enviar Correo")),i.a.createElement(T.a.Row,{className:"form-status"},i.a.createElement(G,{status:m}))))};B.propTypes={courseId:j.a.string.isRequired};var U=a(514),H=a(214),W=a(513),$=function(e){var t=e.email,a=e.modalState,r=e.setModalState;console.log("EmailModal loaded");var n=function(){return r(!1)},o=Object(l.useRef)(null);Object(l.useLayoutEffect)((function(){return window.parent.parent.scrollTo(0,o.current.modalBodyRef.current.offsetTop)}),[]);return i.a.createElement(W.a,{ref:o,open:a,title:"Detalle del correo",body:i.a.createElement("div",{className:"row px-2"},i.a.createElement("div",{className:"font-weight-bold col col-3 py-2"},"Fecha"),i.a.createElement("div",{className:"col col-9 py-2"},t.date),i.a.createElement("div",{className:"font-weight-bold col col-3 py-2"},"Enviado por"),i.a.createElement("div",{className:"col col-9 py-2"},t.sender),i.a.createElement("div",{className:"font-weight-bold col col-3 py-2"},"Asunto"),i.a.createElement("div",{className:"col col-9 py-2"},t.subject),i.a.createElement("div",{className:"font-weight-bold col col-3 py-2"},"Contenido"),i.a.createElement("div",{className:"text-justify col col-9 py-2"},t.message),t.receiver_users&&i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"font-weight-bold col col-3 py-2"},"Destinatarios (",t.receiver_users.length,")"),i.a.createElement("div",{className:"text-justify col col-9 py-2"},i.a.createElement("ol",null,t.receiver_users.map((function(e){return i.a.createElement("li",{key:e},e)})))))),onClose:n,buttons:[i.a.createElement(g.a,{variant:"primary",onClick:n,"data-autofocus":!0},"Cerrar")],renderDefaultCloseButton:!1,dialogClassName:"modal-lg"})};function V(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e))&&"[object Arguments]"!==Object.prototype.toString.call(e))return;var a=[],r=!0,n=!1,o=void 0;try{for(var c,s=e[Symbol.iterator]();!(r=(c=s.next()).done)&&(a.push(c.value),!t||a.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(n)throw o}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}$.propTypes={email:j.a.object.isRequired,modalState:j.a.bool.isRequired,setModalState:j.a.func.isRequired};var K=function(e){var t=e.email;console.log("EmailItem loaded");var a=V(Object(l.useState)(!1),2),r=a[0],n=a[1];return i.a.createElement("div",{className:"row border-bottom"},i.a.createElement("div",{className:"col col-3 pt-2"},t.date),i.a.createElement("div",{className:"col col-3 pt-2"},t.sender),i.a.createElement("div",{className:"col col-5 pt-2"},t.subject),i.a.createElement("div",{className:"col col-1"},i.a.createElement(U.a,{icon:H.faInfo,alt:"Ver mayor información del correo",onClick:function(){return n(!0)},variant:"primary"})),r&&i.a.createElement($,{email:t,modalState:r,setModalState:n}))};K.propTypes={email:j.a.object.isRequired};var Q=a(216),X=function(e){var t=e.title;return i.a.createElement("div",{className:"text-center"},i.a.createElement(E.a,{icon:Q.faFrown,className:"h1"}),i.a.createElement("p",null,"Al parecer no tienes ",t.toLowerCase(),"."))};X.propTypes={title:j.a.string.isRequired};var Y,Z,ee=function(e){var t=e.getEmails,a=e.title,r=e.courseId;console.log("".concat(a," loaded"));var n=function(e,t){var a=I(Object(l.useState)({data:[],loading:!0}),2),r=a[0],n=a[1];return Object(l.useEffect)((function(){n({data:[],loading:!0}),t(e).then((function(e){console.log("emails loaded"),n({data:e,loading:!1})}))}),[t]),r}(r,t),o=n.data,c=n.loading;return i.a.createElement("div",{className:"rounded-lg shadow-lg py-4 px-5 my-2"},i.a.createElement("h3",null,a),c&&i.a.createElement(q.a,{animation:"border",variant:"primary",className:"d-flex mx-auto mt-2 "}),!c&&(0==o.length?i.a.createElement(X,{title:a}):i.a.createElement("div",{className:"email-grid"},i.a.createElement("div",{className:"row font-weight-bold border-bottom py-2"},i.a.createElement("div",{className:"col col-3"},"Fecha"),i.a.createElement("div",{className:"col col-3"},"Enviado por"),i.a.createElement("div",{className:"col col-5"},"Asunto"),i.a.createElement("div",{className:"col col-1 text-center"},"Detalle")),o.map((function(e,t){return i.a.createElement(K,{key:t,email:e})})))))};ee.propTypes={getEmails:j.a.func.isRequired,title:j.a.string.isRequired,courseId:j.a.string.isRequired};var te=function(e){console.log("dispatchResizeMessage");var t=e.type||"mutate",a=document.getElementById("content").offsetHeight,r=document.getElementById("content").offsetWidth;"load"!==t&&r===Z&&a===Y||(window.parent.postMessage({type:"plugin.resize",payload:{width:r,height:a}},document.referrer),Y=a,Z=r,window.scrollTo(0,0))};function ae(e,t,a,r,n,o,c){try{var s=e[o](c),l=s.value}catch(e){return void a(e)}s.done?t(l):Promise.resolve(l).then(r,n)}var re=function(){var e,t=(e=regeneratorRuntime.mark((function e(t){var a,r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getReceivedEmails loaded"),a="/courses/".concat(t,"/course_emails/received"),e.next=4,fetch(a,{credentials:"same-origin"});case 4:if(200!=(r=e.sent).status){e.next=13;break}return e.next=8,r.json();case 8:return n=e.sent,o=n.map((function(e){return{subject:e.subject,message:e.message,sender:e.sender_user__profile__name,date:new Date(e.created_at.$date).toLocaleString("es-CL")}})),e.abrupt("return",o);case 13:return e.abrupt("return",[]);case 14:case"end":return e.stop()}}),e)})),function(){var t=this,a=arguments;return new Promise((function(r,n){var o=e.apply(t,a);function c(e){ae(o,r,n,c,s,"next",e)}function s(e){ae(o,r,n,c,s,"throw",e)}c(void 0)}))});return function(e){return t.apply(this,arguments)}}();function ne(e,t,a,r,n,o,c){try{var s=e[o](c),l=s.value}catch(e){return void a(e)}s.done?t(l):Promise.resolve(l).then(r,n)}var oe=function(){var e,t=(e=regeneratorRuntime.mark((function e(t){var a,r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getSendedEmails loaded"),a="/courses/".concat(t,"/course_emails/sended"),e.next=4,fetch(a,{credentials:"same-origin"});case 4:if(200!=(r=e.sent).status){e.next=13;break}return e.next=8,r.json();case 8:return n=e.sent,o=n.map((function(e){return{subject:e.subject,message:e.message,sender:e.sender_user,receiver_users:e.receiver_users_list,date:new Date(e.created_at.$date).toLocaleString("es-CL")}})),e.abrupt("return",o);case 13:return e.abrupt("return",[]);case 14:case"end":return e.stop()}}),e)})),function(){var t=this,a=arguments;return new Promise((function(r,n){var o=e.apply(t,a);function c(e){ne(o,r,n,c,s,"next",e)}function s(e){ne(o,r,n,c,s,"throw",e)}c(void 0)}))});return function(e){return t.apply(this,arguments)}}();function ce(){Object(l.useEffect)((function(){return window!==window.parent&&(document.body.className+=" view-in-mfe",Y=window.offsetHeight,Z=window.offsetWidth,new MutationObserver(te).observe(document.body,{attributes:!0,childList:!0,subtree:!0}),window.addEventListener("load",te),window.addEventListener("resize",te)),function(){window.removeEventListener("load",te),window.removeEventListener("resize",te)}}),[]);var e=window.location.hash.substring(1).split(/[\/]+/).pop();return i.a.createElement("div",{id:"content",className:"container"},i.a.createElement(v.a,null,i.a.createElement("div",null,i.a.createElement(x,null),i.a.createElement(b.c,null,i.a.createElement(b.a,{exact:!0,path:"/eol/eol_course_email/static/sended/"},i.a.createElement(ee,{getEmails:oe,title:"Correos Enviados",courseId:e})),i.a.createElement(b.a,{exact:!0,path:"/eol/eol_course_email/static/received/"},i.a.createElement(ee,{getEmails:re,title:"Correos Recibidos",courseId:e})),i.a.createElement(b.a,{exact:!0,path:"/eol/eol_course_email/static/new/"},i.a.createElement(B,{courseId:e})),i.a.createElement(b.a,{exact:!0,path:"/eol/eol_course_email/static/:courseId/"},i.a.createElement(ee,{getEmails:re,title:"Correos Recibidos",courseId:e}))))))}a(466),a.p;Object(r.b)(n.h,(function(){m.a.render(i.a.createElement(c.a,null,i.a.createElement(ce,null)),document.getElementById("root"))})),Object(r.b)(n.e,(function(e){m.a.render(i.a.createElement(s.a,{message:e.message}),document.getElementById("root"))})),Object(o.b)({messages:[p]})}},[[501,1,2]]]);
//# sourceMappingURL=app.89b19bae7ac30d4181c8.js.map